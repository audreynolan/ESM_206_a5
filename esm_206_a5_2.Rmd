---
title: "ESM 206 Assignment 5"
author: "Zoe Duerksen-Salm & Audrey Nolan"
date: "11/23/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE)
```

```{r}
# attach packages
library(tidyverse)
library(janitor)
library(plotly)
library(kableExtra)
library(dplyr)
library(here)
library(ggbeeswarm)
library(car)

# read in data
mack_raw <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names() %>% 
  filter(species == "DITE") %>% 
  select(-pitnumber, -length2, -notes)
```

Part A: 

Describe the trends in graph (in text). 

```{r}
# Note: Pacific Giant Salamanders, Dicamptodon tenebrosus (DITE).

# wrangle data - total annual counts of DITE for OG and CC for all years.

counts_dite <- mack_raw %>% 
  group_by(year, species, section) %>%
  summarize(counts = sum(entity))

# make graph - show changes in annual counts for sections over time.
# graph additions - caption + aesthetic formatting.

ggplot(counts_dite, aes(x = year, y = counts, group = section, color = section))+
  geom_line()+
  theme_minimal()

# orrrr.
ggplot(counts_dite, aes(x = year, y = counts))+
  geom_col()+
  facet_wrap(~section)
```

---

Part B: 

Add a table caption above the table. 

```{r}
# Note: I = riffle, IP = Isolated pools, 

# wrangle data - for DITE counts in diff channels in 2017.
channel_section <- mack_raw %>%
  filter(year == "2017", 
         unittype!="IP") %>% 
  group_by(unittype, section) %>%
  summarize(counts = sum(entity)) %>% 
  pivot_wider(names_from = unittype, values_from = counts) %>% 
  rename("Section" = section,
         "Cascades" = C,
         "Pool" = P,
         "Side-channel" = SC)

# tidy df - elongating abbreviations
channel_section$Section <- gsub("CC", "Clear cut", channel_section$Section)
channel_section$Section <- gsub("OG", "Old growth", channel_section$Section)

# mutate df - to get proportions of counts per channel.
channel_section_props <- channel_section %>% 
  adorn_percentages((denominator = "row")) %>% 
  adorn_pct_formatting(digits = 0) %>% 
  adorn_ns(position = "front")

# make table - of counts + proportions of DITE per channel in 2017.
kable(channel_section_props) %>% 
  kable_styling()

###

# old df... should DELETE
dite_2017 <- mack_raw %>%
  filter(year == "2017", 
         unittype!="IP") %>% 
  group_by(unittype, section) %>%
  summarize(counts = sum(entity)) %>% 
  group_by(section) %>% 
  mutate(proportion = round(((counts/sum(counts))*100), digits = 2))

# old table... should DELETE
kable(dite_2017) %>% 
  kable_styling()
```

---

Part C:

Is there a significant difference in where in the channel Pacific giant salamanders are located (pool, cascade or side channel) between the two sections (old growth and clear cut)? 
Regarding the locations where salamanders were observed in Mack Creek in 2017, is there a significant effect of forest condition (old growth or clear cut) on where in the channel salamanders are found (channel classification)?

Report your statistical findings in text, in the context of the actual counts / proportions you present in the table. 

- Report in text (in context of actual counts), referencing table from Part B

**There is not a significant effect of forest condition (old growth or clear cut) on where in the channel salamanders are found (channel classification).**

Another way to say this **forest condition and channel classification ARE independent**.

```{r}
# chi-square test
chi_dite <- channel_section %>% 
  select(-Section)

dite_chi_test <- chisq.test(chi_dite)

dite_chi_test

# old in-text referencing:

# Mean size (mm) for MPA sites (`r round(protection_2012$estimate[1],2)`) and non-MPA sites (`r round(protection_2012$estimate[2],2)`) in the year 2012 differ significantly (t(`r round(protection_2012$parameter,2)`) = (`r round(protection_2012$statistic,2)`, *p* = (`r round(protection_2012$p.value,2)`). 

```

---

Part D:

_Question:_ Is there a significant difference in mean weights for Pacific giant salamanders observed in the two forest sections (clear cut and old growth) in 2017? 

_Answer:_ In 2017, there is not a significant difference in mean weights for Pacific giant salamanders observed in the two forest sections (clear cut and old growth).

- mean weight of DITE in clear cut forest sections is 0.66 grams higher than in old growth sections (5.43 and 4.77 respectively).
- similar counts in the two forest sections: 368 at CC, 328 at OG (40 indiv diff).

```{r}
# wrangle data - for 2017, find dite counts + median, mean, sdev for dite weights.
weight_section <- mack_raw %>% 
  filter(year == "2017") %>% 
  group_by(section) %>% 
  summarize(median_weight = median(weight, na.rm = TRUE),
            mean_weight = round(mean(weight, na.rm = TRUE), digits = 2),
            sdev = round(sd(weight, na.rm = TRUE), digits = 2),
            count = sum(entity))

# make table - showing summary stats for weights dependent on forest sections.
kable(weight_section) %>% 
  kable_styling()

# Is there a significant difference in mean weights for Pacific Giant Salamanders observed in the two forest sections in 2017? 

weight_section_mean <- t.test(weight_section$mean_weight)

# p = 0.053
```

---

Part E

Compare weights of Pacific giant salamanders in pools, cascades and side-channels of Mack Creek in 2017. Pool salamander observations from both the old growth and clear cut sections for this part (i.e., you will not consider “section” as a factor here).

First, visually compare Pacific giant salamander weights between the three channel classifications. You can choose how to best visualize the weights between the three groups (Beeswarm? Jitter? Histogram? Density? Something else?), but you should indicate values for the mean, and standard deviation, standard error or a 95% confidence interval. Add a figure caption. 

```{r}
weight_channel <- mack_raw %>% 
  filter(year == "2017",
         species == "DITE",
         unittype != "IP") %>%
  group_by(unittype)

# Beeswarm
ggplot(data = weight_channel, aes(x = unittype, y = weight)) +
  geom_beeswarm()

# Jitter
ggplot(data = weight_channel, aes(x = unittype, y = weight)) +
  geom_jitter()

# Density (faceted)
ggplot(data = weight_channel, aes(x = weight, group = unittype, color = unittype)) +
  geom_density() +
  facet_wrap(~unittype)

# Histograms (faceted) 
ggplot(data = weight_channel, aes(x = weight)) +
  geom_histogram(aes(fill = unittype),
                 alpha = 0.5,
                 show.legend = FALSE,
                 bins = 15) +
  facet_wrap(~unittype, scales = "free")

# QQ plots (faceted)
ggplot(data = weight_channel, aes(sample = weight)) +
  geom_qq(aes(color = unittype),
                 alpha = 0.5,
                 show.legend = FALSE
          ) +
  facet_wrap(~unittype, scales = "free")

```

Second, answer: Is there a significant difference in mean weights for Pacific giant salamanders observed in pools vs. cascades vs. side-channels in 2017? Describe the results of your statistical analysis in text, within the context of broader (and more important) measures of differences between groups (some options: means differences, effect sizes, percent differences, etc). 

```{r}
weight_channel_summary <- weight_channel %>% 
  summarize(
    mean_weight = mean(weight, na.rm = TRUE),
    sd_weight = sd(weight, (na.rm = TRUE)),
    sample_size = n(),
    se_weight = sd((weight) / sqrt(n()), (na.rm = TRUE)),
    var_weight = var(weight, na.rm = TRUE)
  )

kable(weight_channel_summary) %>% 
  kable_styling()

# Importantly, variances are SOMEWHAT close (largest is < 4x greater than the smallest)
# But we can perform a Levene's Test for equal variances anyway: 

leveneTest(weight ~ unittype, data = weight_channel)
```

```{r}
# One-way ANOVA

weight_aov <- aov(weight ~ unittype, data = weight_channel)

summary(weight_aov)

# We retain the alternative hypothesis (mean weight for the 3 species are NOT the same). But are they all different from each other? Or just two? 

weight_lm <- lm(weight ~ unittype, data = weight_channel)
weight_aov_t3 <- Anova(weight_lm)

weight_aov_t3

## Anova Table (Type II tests)
## 
## Response: flipper_length_mm
##            Sum Sq  Df F value    Pr(>F)    
## species   21415.6   2  411.79 < 2.2e-16 ***
## Residuals  4212.6 162                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
# Notice that the F statistic value here (411.79) is almost exactly the same - the difference between these two is minimal. 
```

```{r}
TukeyHSD(weight_aov)
```

Third, describe any concerns you have about comparing means across the groups. What might be another option to consider moving forward with the analysis? (You don’t need to actually do that here, just describe briefly in 1-2 sentences.)